<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>OBS Alias Manager</title>

<style>
:root {
  --bg: #1a1a1a;
  --panel: #2a2a2a;
  --accent: #d16ce6;
  --accent-hover: #ff66cc;
  --danger: #ff4b4b;
  --text: #e1e1e1;
  --muted: #aaa;
}

* { box-sizing: border-box; }

body {
  margin: 0;
  padding: 12px;
  background: var(--bg);
  color: var(--text);
  font-family: system-ui, sans-serif;
}

h1 {
  color: var(--accent);
  font-size: 1.5rem;
  margin-bottom: 12px;
}

.command {
  background: var(--panel);
  border-radius: 8px;
  padding: 12px;
  margin-bottom: 10px;
}

.command-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.command-name {
  font-weight: bold;
  font-size: 1.1rem;
}

.command-desc {
  font-size: 0.9rem;
  color: var(--muted);
  margin: 4px 0;
}

.alias-group {
  font-size: 0.85rem;
  margin-top: 6px;
}

.alias {
  display: inline-flex;
  align-items: center;
  background: #1f1f1f;
  padding: 4px 6px;
  border-radius: 4px;
  margin: 2px;
}

button {
  background: var(--accent);
  color: white;
  border: none;
  border-radius: 4px;
  padding: 6px 10px;
  cursor: pointer;
  font-weight: bold;
}

button:hover {
  background: var(--accent-hover);
}

button.danger {
  background: var(--danger);
}

button.small {
  padding: 2px 6px;
  font-size: 0.75rem;
  margin-left: 6px;
}

.add-box {
  background: var(--panel);
  border-radius: 8px;
  padding: 10px;
  margin-top: 16px;
}

input {
  background: #111;
  color: var(--text);
  border: 1px solid #444;
  border-radius: 4px;
  padding: 6px;
  margin-right: 6px;
}

</style>
</head>
<body>

<h1>Command Aliases</h1>

<div id="commands"></div>

<div class="add-box">
  <h3>Add Alias</h3>
  <input id="alias" placeholder="alias">
  <input id="command" placeholder="command">
  <button onclick="addAlias()">Add</button>
</div>

<script>
async function loadAliases() {
  const res = await fetch("/api/obs/aliases", { credentials: "include" });
  const data = await res.json();

  const container = document.getElementById("commands");
  container.innerHTML = "";

  const aliasesByCommand = {};
  for (const [alias, command] of Object.entries(data.aliases)) {
    if (!aliasesByCommand[command]) aliasesByCommand[command] = [];
    aliasesByCommand[command].push(alias);
  }

  data.commands.forEach(cmd => {
    const disabled = data.disabled_commands.includes(cmd.name);
    const custom = aliasesByCommand[cmd.name] || [];

    const div = document.createElement("div");
    div.className = "command";

    div.innerHTML = `
      <div class="command-header">
        <div class="command-name">${cmd.name}</div>
        <button onclick="toggleCmd('${cmd.name}', ${!disabled})">
          ${disabled ? "Enable" : "Disable"}
        </button>
      </div>

      <div class="command-desc">${cmd.description}</div>

      <div class="alias-group">
        <b>Default:</b>
        ${cmd.default_aliases.length
          ? cmd.default_aliases.map(a => `<span class="alias">${a}</span>`).join("")
          : "—"}
      </div>

      <div class="alias-group">
        <b>Custom:</b>
        ${custom.length
          ? custom.map(a =>
              `<span class="alias">${a}
                <button class="small danger" onclick="removeAlias('${a}')">✖</button>
               </span>`
            ).join("")
          : "—"}
      </div>
    `;

    container.appendChild(div);
  });
}

async function addAlias() {
  await fetch("/api/obs/aliases/add", {
    method: "POST",
    credentials: "include",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      alias: document.getElementById("alias").value,
      command: document.getElementById("command").value
    })
  });
  loadAliases();
}

async function removeAlias(alias) {
  await fetch("/api/obs/aliases/remove", {
    method: "POST",
    credentials: "include",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ alias })
  });
  loadAliases();
}

async function toggleCmd(command, disable) {
  await fetch("/api/obs/aliases/toggle", {
    method: "POST",
    credentials: "include",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ command, disable })
  });
  loadAliases();
}

const evt = new EventSource("/api/obs/queue/events", { withCredentials: true });
evt.onmessage = loadAliases;

loadAliases();
</script>

</body>
</html>

